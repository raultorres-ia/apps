<!DOCTYPE html>
<!-- 
© 2025 Raül Torres. Aquest codi està sota la llicència AGPL v3.
Pots trobar el text complet de la llicència al fitxer LICENSE.txt.
-->
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-lang="title">Conversor HTML a Markdown</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/turndown/dist/turndown.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Estil per a la barra de desplaçament */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e293b;
        }
        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
        .output-area {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .drag-over {
            border-color: #0ea5e9; /* sky-500 */
            background-color: rgba(30, 41, 59, 0.5); /* slate-800 with opacity */
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-200 antialiased">
    <div class="min-h-screen flex flex-col items-center justify-between p-4 sm:p-6 lg:p-8">
        
        <div class="w-full max-w-7xl mx-auto flex-grow">
            <!-- Capçalera i selector d'idioma -->
            <header class="flex flex-col sm:flex-row justify-between items-center mb-6">
                <h1 class="text-3xl font-bold text-sky-400 mb-4 sm:mb-0" data-lang="main-title">Conversor HTML a Markdown</h1>
                <div class="flex items-center space-x-2 bg-slate-800 p-1 rounded-lg">
                    <button id="btn-ca" class="lang-btn px-3 py-1 text-sm font-medium rounded-md transition-colors bg-sky-500 text-white">CAT</button>
                    <button id="btn-es" class="lang-btn px-3 py-1 text-sm font-medium rounded-md transition-colors text-slate-400 hover:bg-slate-700">ES</button>
                    <button id="btn-en" class="lang-btn px-3 py-1 text-sm font-medium rounded-md transition-colors text-slate-400 hover:bg-slate-700">EN</button>
                </div>
            </header>
            
            <main class="w-full">
                <p class="text-slate-400 mb-6" data-lang="description">
                    Enganxa el teu codi HTML a l'esquerra per veure'l convertit a Markdown a la dreta a l'instant.
                </p>

                <!-- Àrea de conversió -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 h-[60vh] min-h-[500px]">
                    <!-- Editor HTML -->
                    <div id="drop-zone" class="flex flex-col h-full border-2 border-dashed border-slate-700/50 rounded-lg p-2 transition-colors">
                        <div class="flex justify-between items-center mb-2">
                            <label for="html-input" class="font-semibold text-slate-300" data-lang="html-label">Codi HTML</label>
                            <label for="file-input" class="cursor-pointer text-sm bg-slate-700 hover:bg-sky-600 text-slate-200 font-semibold py-1 px-3 rounded-md transition-colors" data-lang="select-file-button">
                                Seleccionar fitxer
                            </label>
                            <input type="file" id="file-input" accept=".html,.htm" class="hidden">
                        </div>
                        <p class="text-center text-sm text-slate-500 mb-2" data-lang="drop-zone-text">O arrossega i deixa anar un fitxer en aquesta àrea</p>
                        <textarea 
                            id="html-input" 
                            class="w-full flex-grow p-4 bg-slate-800 border border-slate-700 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-sky-500 transition-shadow"
                            data-lang-placeholder="html-placeholder"
                            placeholder="<h1>Hola Món!</h1><p>Això és un paràgraf amb <strong>text en negreta</strong>.</p><ul><li>Element 1</li><li>Element 2</li></ul>"
                        ></textarea>
                    </div>

                    <!-- Visualitzador Markdown -->
                    <div class="flex flex-col h-full">
                        <div class="flex justify-between items-center mb-2">
                            <label for="markdown-output" class="font-semibold text-slate-300" data-lang="markdown-label">Resultat en Markdown</label>
                            <button id="download-btn" class="text-sm bg-sky-600 hover:bg-sky-500 text-white font-semibold py-1 px-3 rounded-md transition-colors disabled:bg-slate-600 disabled:cursor-not-allowed" disabled data-lang="download-button">
                                Descarrega .MD
                            </button>
                        </div>
                        <div class="w-full flex-grow p-4 bg-slate-800 border border-slate-700 rounded-lg overflow-auto">
                            <pre><code id="markdown-output" class="output-area"></code></pre>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Peu de pàgina -->
        <footer class="w-full max-w-7xl mx-auto text-center text-xs text-slate-500 pt-8">
            <p>© 2025 Raül Torres</p>
            <p class="mt-2">
                <span data-lang="license-code">Llicència del codi:</span> <a href="LICENSE.txt" target="_blank" class="underline hover:text-sky-400">AGPL v3</a>
                ·
                <span data-lang="license-content">Contingut:</span> 
                <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer" class="underline hover:text-sky-400 inline-flex items-center gap-1">
                    CC BY-SA 4.0
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-2.5-8.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm5 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm-5.03 4.5c.8-.62 1.87-1 3.03-1s2.23.38 3.03 1h-6.06z"/></svg>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-.71-11.29c-.39-.39-1.02-.39-1.41 0L8.46 10.1c.39.39 1.02.39 1.41 0l1.42-1.42zM12 14c-2.21 0-4-1.79-4-4h2c0 1.1.9 2 2 2s2-.9 2-2h2c0 2.21-1.79 4-4 4z"/></svg>
                </a>
            </p>
        </footer>
    </div>

    <!-- Àrea per a notificacions -->
    <div id="notification-area" class="fixed bottom-5 right-5 z-50 flex flex-col items-end space-y-2"></div>

    <script>
        // © 2025 Raül Torres. Aquest codi està sota la llicència AGPL v3.
        document.addEventListener('DOMContentLoaded', () => {
            const htmlInput = document.getElementById('html-input');
            const markdownOutput = document.getElementById('markdown-output');
            const dropZone = document.getElementById('drop-zone');
            const fileInput = document.getElementById('file-input');
            const downloadBtn = document.getElementById('download-btn');
            
            if (typeof TurndownService === 'undefined') {
                showNotification('Error: La llibreria de conversió no s\'ha pogut carregar.', 'error');
                return;
            }

            const turndownService = new TurndownService({ 
                headingStyle: 'atx',
                codeBlockStyle: 'fenced'
            });

            const translations = {
                ca: {
                    'title': 'Conversor HTML a Markdown',
                    'main-title': 'Conversor HTML a Markdown',
                    'description': "Enganxa el teu codi HTML a l'esquerra per veure'l convertit a Markdown a la dreta a l'instant.",
                    'html-label': 'Codi HTML',
                    'markdown-label': 'Resultat en Markdown',
                    'html-placeholder': "<h1>Hola Món!</h1>\n<p>Això és un paràgraf amb <strong>text en negreta</strong>.</p>\n<ul>\n  <li>Element 1</li>\n  <li>Element 2</li>\n</ul>",
                    'license-code': 'Llicència del codi:',
                    'license-content': 'Contingut:',
                    'select-file-button': 'Seleccionar fitxer',
                    'drop-zone-text': 'O arrossega i deixa anar un fitxer en aquesta àrea',
                    'download-button': 'Descarrega .MD',
                    'file-type-error': 'Si us plau, selecciona un fitxer HTML (.html o .htm).'
                },
                es: {
                    'title': 'Conversor HTML a Markdown',
                    'main-title': 'Conversor HTML a Markdown',
                    'description': 'Pega tu código HTML a la izquierda para verlo convertido a Markdown a la derecha al instante.',
                    'html-label': 'Código HTML',
                    'markdown-label': 'Resultado en Markdown',
                    'html-placeholder': "<h1>¡Hola Mundo!</h1>\n<p>Esto es un párrafo con <strong>texto en negrita</strong>.</p>\n<ul>\n  <li>Elemento 1</li>\n  <li>Elemento 2</li>\n</ul>",
                    'license-code': 'Licencia del código:',
                    'license-content': 'Contenido:',
                    'select-file-button': 'Seleccionar archivo',
                    'drop-zone-text': 'O arrastra y suelta un archivo en esta área',
                    'download-button': 'Descargar .MD',
                    'file-type-error': 'Por favor, selecciona un archivo HTML (.html o .htm).'
                },
                en: {
                    'title': 'HTML to Markdown Converter',
                    'main-title': 'HTML to Markdown Converter',
                    'description': 'Paste your HTML code on the left to see it instantly converted to Markdown on the right.',
                    'html-label': 'HTML Code',
                    'markdown-label': 'Markdown Output',
                    'html-placeholder': "<h1>Hello World!</h1>\n<p>This is a paragraph with <strong>bold text</strong>.</p>\n<ul>\n  <li>Item 1</li>\n  <li>Item 2</li>\n</ul>",
                    'license-code': 'Code license:',
                    'license-content': 'Content:',
                    'select-file-button': 'Select file',
                    'drop-zone-text': 'Or drag and drop a file in this area',
                    'download-button': 'Download .MD',
                    'file-type-error': 'Please select an HTML file (.html or .htm).'
                }
            };
            
            const langButtons = document.querySelectorAll('.lang-btn');

            function setLanguage(lang) {
                const langStrings = translations[lang];
                document.querySelectorAll('[data-lang]').forEach(el => {
                    const key = el.getAttribute('data-lang');
                    if (langStrings[key]) {
                        el.textContent = langStrings[key];
                    }
                });
                document.querySelectorAll('[data-lang-placeholder]').forEach(el => {
                    const key = el.getAttribute('data-lang-placeholder');
                    if(langStrings[key]) {
                        el.placeholder = langStrings[key];
                    }
                });
                
                document.documentElement.lang = lang;

                langButtons.forEach(btn => {
                    btn.classList.toggle('bg-sky-500', btn.id === `btn-${lang}`);
                    btn.classList.toggle('text-white', btn.id === `btn-${lang}`);
                    btn.classList.toggle('text-slate-400', btn.id !== `btn-${lang}`);
                    btn.classList.toggle('hover:bg-slate-700', btn.id !== `btn-${lang}`);
                });
            }

            langButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    setLanguage(btn.id.split('-')[1]);
                });
            });

            function convertHtmlToMarkdown() {
                try {
                    const html = htmlInput.value;
                    const markdown = turndownService.turndown(html);
                    markdownOutput.textContent = markdown;
                    downloadBtn.disabled = !markdown.trim();
                } catch (error) {
                    markdownOutput.textContent = `S'ha produït un error durant la conversió.\n\nDetalls tècnics:\n${error.message}`;
                    downloadBtn.disabled = true;
                    console.error("Conversion Error:", error);
                }
            }
            
            function showNotification(message, type = 'info') {
                const notificationArea = document.getElementById('notification-area');
                const bgColor = type === 'error' ? 'bg-red-500' : 'bg-sky-500';
                const notification = document.createElement('div');
                notification.className = `px-4 py-2 rounded-md text-white shadow-lg transition-all transform translate-y-4 opacity-0 ${bgColor}`;
                notification.textContent = message;
                
                notificationArea.appendChild(notification);

                setTimeout(() => {
                    notification.classList.remove('translate-y-4', 'opacity-0');
                }, 10);

                setTimeout(() => {
                    notification.classList.add('opacity-0');
                    notification.addEventListener('transitionend', () => notification.remove());
                }, 3000);
            }

            function handleFile(file) {
                if (file && (file.type === 'text/html' || file.name.endsWith('.html') || file.name.endsWith('.htm'))) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        htmlInput.value = e.target.result;
                        convertHtmlToMarkdown();
                        window.scrollTo({ top: 0, behavior: 'smooth' }); // Torna a l'inici de la pàgina
                    };
                    reader.readAsText(file, 'UTF-8');
                } else {
                    const currentLang = document.documentElement.lang || 'ca';
                    showNotification(translations[currentLang]['file-type-error'], 'error');
                }
            }

            // --- Event Listeners ---
            htmlInput.addEventListener('input', convertHtmlToMarkdown);

            // Torna a l'inici en enganxar text per a una millor experiència
            htmlInput.addEventListener('paste', () => {
                // Utilitzem requestAnimationFrame per assegurar que el desplaçament es produeix 
                // després que el navegador hagi processat l'acció d'enganxar.
                requestAnimationFrame(() => {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            });

            fileInput.addEventListener('change', (e) => e.target.files.length && handleFile(e.target.files[0]));
            
            downloadBtn.addEventListener('click', () => {
                const blob = new Blob([markdownOutput.textContent], { type: 'text/markdown;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'converted.md';
                a.click();
                URL.revokeObjectURL(url);
            });

            // Drag and Drop Listeners
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('drag-over');
            });
            dropZone.addEventListener('dragleave', (e) => {
                e.preventDefault();
                dropZone.classList.remove('drag-over');
            });
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('drag-over');
                if (e.dataTransfer.files.length) {
                    handleFile(e.dataTransfer.files[0]);
                }
            });

            // Càrrega inicial
            setLanguage('ca');
            htmlInput.value = translations.ca['html-placeholder'];
            convertHtmlToMarkdown();
        });
    </script>
</body>
</html>

