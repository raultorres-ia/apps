<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Tresor de la Font d'en Pericot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* Efecte de passar p√†gina 3D */
        .perspective-container {
            perspective: 2000px;
        }
        
        .page-enter {
            transform-origin: left center;
            animation: pageTurn 0.8s cubic-bezier(0.25, 1, 0.5, 1) forwards;
            backface-visibility: hidden;
        }

        @keyframes pageTurn {
            0% {
                opacity: 0;
                transform: rotateY(-30deg) translateX(20px);
                filter: brightness(0.9);
            }
            100% {
                opacity: 1;
                transform: rotateY(0deg) translateX(0);
                filter: brightness(1);
            }
        }

        /* Estils base per al mode llibre */
        .font-serif {
            font-family: 'Merriweather', 'Georgia', serif;
        }
        
        /* Scroll suau */
        html {
            scroll-behavior: smooth;
        }
    </style>
</head>
<body class="bg-stone-100 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Icones SVG (inline per no dependre de llibreries externes) ---
        const IconBookOpen = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
        );
        const IconRotateCcw = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
        );
        const IconHome = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        );
        const IconArrowLeft = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>
        );
        const IconVolume2 = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>
        );
        const IconExternalLink = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
        );
        const IconMusic = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>
        );
        const IconArrowRight = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
        );

        // --- Dades de l'aplicaci√≥ ---
        const nodeSteps = {
            'Introducci': 1,
            'dinsDaquestViatg': 2,
            'perTalDeVncerLaS': 3,
            'Prleg': 4,
            'Captol_1': 5,
            'Suno': 5, 'Propostes_aula_Suno': 5,
            'Captol_2': 6,
            'Captol_3': 7,
            'Captol_4': 8,
            'NotebookLM': 8, 's_NotebookLM': 8,
            'Captol_5': 9,
            'Captol_6': 10,
            'Nano_Banana': 10, 's_Nano_Banana': 10,
            'Captol_7': 11,
            'Captol_8': 12,
            'Captol_9': 13,
            'Brisk': 13,
            'Eines': 14
        };
        const totalSteps = 14;

        const storyData = {
            "Introducci": {
                title: "Introducci√≥",
                image: "https://raultorres-ia.github.io/apps/gami_pericot/banner.jpg",
                content: `
                <p>En Ra√ºl i la G√®nia us convidem a una experi√®ncia gamificada per descobrir el potencial de la intel¬∑lig√®ncia artificial a la nostra escola; basada en una experi√®ncia d'en Pere Cornell√†.</p>
                <ul class="list-disc pl-5 space-y-2 mt-4">
                    <li><strong>El Repte:</strong> Com en la llegenda gironina, ens enfrontarem a la "serp" per perdre la por a la tecnologia.</li>
                    <li><strong>El Viatge</strong>: Una hist√≤ria interactiva (Tria la teva aventura) on explorarem eines pr√†ctiques i reflexions √®tiques.</li>
                    <li><strong>El Tresor</strong>: Guanyar la pedra preciosa, que representa el bon √∫s de la IA per transformar la nostra tasca docent.</li>
                </ul>`,
                choices: [{ text: "I qu√® volem aconseguir amb aix√≤?", target: "dinsDaquestViatg" }]
            },
            "dinsDaquestViatg": {
                title: "Dins d'aquest viatge...",
                content: `
                <p>Dins d'aquest viatge per la llegenda de la font d'en Pericot, ens proposem assolir les seg√ºents fites:</p>
                <ul class="list-disc pl-5 space-y-3 mt-4">
                    <li><strong>Revisitar el cam√≠ recorregut</strong>: Reviure i consolidar els aprenentatges i reflexions fets fins ara sobre la IA, connectant-los amb la nostra realitat de centre.</li>
                    <li><strong>Domar la "serp"</strong> (noves eines): Perdre la por a l'exploraci√≥ tecnol√≤gica tot descobrint eines d'IAG in√®dites per a nosaltres, passant de la teoria a la pr√†ctica mitjan√ßant la creaci√≥ de productes reals.</li>
                    <li><strong>Trobar la "pedra preciosa"</strong> (la caixa d'eines): Elaborar un inventari estrat√®gic i personalitzat. No es tracta de tenir moltes eines, sin√≥ de triar les millors per a cada prop√≤sit (continguts, gesti√≥, aula) per tal de construir un ecosistema digital eficient, √®tic i responsable.</li>
                </ul>`,
                choices: [{ text: "I com ho farem?", target: "perTalDeVncerLaS" }]
            },
            "perTalDeVncerLaS": {
                title: "Per tal de v√®ncer la serp...",
                content: `
                <p>Per tal de v√®ncer la serp i trobar el tresor, ens organitzarem de la seg√ºent manera:</p>
                <ul class="list-disc pl-5 space-y-3 mt-4">
                    <li><strong>Formaci√≥ d'expedicions</strong>: Treballarem en equips d'un m√†xim de 5 persones. Cada grup navegar√† per la llegenda i prendr√† les seves pr√≤pies decisions de forma independent.</li>
                    <li><strong>Cron√≤metre en marxa</strong>: L'aventura t√© un temps limitat. Haurem d'haver superat els reptes abans de l'hora l√≠mit per fer la posada en com√∫.</li>
                    <li><strong>El Consell de savis</strong> (cerca del tresor): En acabar, compartirem les nostres "pedres precioses" en un document compartit (Google Sheets).</li>
                    <li><strong>L‚ÄôHer√®ncia digital</strong>: En aquest registre final, hi recollirem:
                    <ul class="list-circle pl-5 mt-2 space-y-1 text-gray-700">
                        <li><strong>Les eines</strong> escollides per cada equip.</li>
                        <li><strong>El "perqu√®"</strong> de la tria (per a qu√® ens serviran realment al dia a dia).</li>
                        <li><strong>Conclusions i reflexions</strong> clau per a l‚Äôescola.</li>
                    </ul>
                    </li>
                </ul>`,
                choices: [{ text: "L'expedici√≥ ja est√† en marxa... Ens veiem a la Font d'en Pericot", target: "Prleg" }]
            },
            "Prleg": {
                title: "Pr√≤leg",
                content: `<p>L'antiga Font Romana, a Sant Daniel, va passar a ser la d'en Pericot el s. XVIII. Entre horts i monestirs, el seu a√Øllament va crear mites de verges i amors prohibits en un paratge ple de misteri.</p>`,
                choices: [{ text: "Cap√≠tol 1: L'origen de la deu de l'oli", target: "Captol_1" }]
            },
            "Captol_1": {
                title: "Cap√≠tol 1",
                image: "https://raultorres-ia.github.io/apps/gami_pericot/01.jpg",
                content: `<p>A la Vall de Sant Daniel, la Font d‚Äôen Pericot amaga un passat m√†gic: diuen que abans no hi rajava aigua, sin√≥ un oli preuat, per√≤ estava custodiada per una serp monstruosa. El r√®ptil duia incrustada al front una gemma resplendent que tothom se'n delia, per√≤ ning√∫ s‚Äôhi acostava per por de ser devorat.</p>`,
                links: [{ text: "Escolta el cap√≠tol cantat (Suno)", url: "https://suno.com/s/4B6s0xJKgpzHyJu9" }],
                choices: [
                    { text: "Cap√≠tol 2: La pagesa de la Vall", target: "Captol_2" },
                    { text: "-Descobreix com s‚Äôha creat la can√ß√≥-", target: "Suno" }
                ]
            },
            "Suno": {
                title: "Suno AI",
                image: "https://perecornella.cat/iaraque/imatges/suno-ai-logo.png",
                content: `
                <p>La can√ß√≥ que ressona en l‚Äôescena √©s un eco creat expressament per a aquest viatge. Una melodia que acompanya Lyra des de la nost√†lgia fins a la confian√ßa. Una veu que travessa les muralles i es converteix en companya de cam√≠. Aquesta pe√ßa no ha nascut d‚Äôun instrument antic ni d‚Äôun cor ocult en les parets: ha estat generada amb Suno https://suno.com/, una eina d‚Äôintel¬∑lig√®ncia artificial pensada per crear m√∫sica de manera immediata i accessible.</p>
                <p class="mt-4 mb-2 font-semibold">Els passos s√≥n tan senzills com poderosos:</p>
                <ol class="list-decimal pl-5 space-y-3">
                    <li><strong>Crear un compte a Suno</strong> (versi√≥ gratu√Øta o de pagament, segons necessitats). La versi√≥ gratu√Øta ja permet generar can√ßons utilitzant un sistema de cr√®dits.</li>
                    <li><strong>Escriure una ‚Äúsong description‚Äù amb el to i l‚Äôestil desitjat</strong>, en aquest cas, una atmosfera nost√†lgica que desemboca en esperan√ßa.</li>
                    <li><strong>Afegir la lletra</strong>, creada especialment per a la hist√≤ria. Un cop m√©s, ChatGPT hi va col¬∑laborar.</li>
                    <li><strong>Escollir l‚Äôestil musical que m√©s encaixa</strong>: √®pic, ac√∫stic, electr√≤nic, cinem√†tic, etc. Com que es pot descriure, en aquest cas es va demanar: <em>A gentle, emotional song that begins with a sense of confusion and noise, then slowly transforms into calm and hope. Dreamy, cinematic style with soft vocals and a reflective tone, like someone finding clarity after being lost.</em></li>
                    <li><strong>Generar la can√ß√≥ i escoltar les versions proposades</strong>.</li>
                    <li><strong>Triar la millor i obtenir l‚Äôenlla√ß per compartir-la</strong>. Aix√≠ la m√∫sica es converteix en part de l‚Äôaventura, no com un simple recurs extern, sin√≥ com una for√ßa narrativa que acompanya el proc√©s creatiu i l‚Äôemoci√≥ de la protagonista.</li>
                </ol>`,
                choices: [
                    { text: "- Veure algunes propostes d'√∫s-", target: "Propostes_aula_Suno" },
                    { text: "Continua al cap√≠tol 2: La pagesa de la vall", target: "Captol_2" }
                ]
            },
            "Propostes_aula_Suno": {
                title: "Propostes a l'aula - Suno",
                image: "https://raultorres-ia.github.io/apps/gami_pericot/banner.jpg",
                content: `
                <h3 class="text-xl font-bold text-emerald-800 mb-4">ALGUNES PROPOSTES ‚Äî Suno a l‚Äôaula</h3>
                <p class="mb-4">Igual que Lyra transforma les seves emocions en can√ß√≥, nosaltres tamb√© podem convertir l‚Äôaprenentatge en m√∫sica. Crear amb Suno no √©s nom√©s generar sons: √©s donar veu a all√≤ que els infants pensen, imaginen i descobreixen.</p>
                <p class="mb-6">Quan l‚Äôalumnat escriu una lletra, tria un estil i escolta com la seva idea pren forma, viu el poder de la creativitat i de la tecnologia treballant plegades. I, igual que l‚Äôalumnat, el professorat tamb√© pot deixar-se sorprendre pel poder de crear amb veu pr√≤pia: Suno pot esdevenir una porta d‚Äôentrada per descobrir la IAG des de la curiositat, la complicitat i l‚Äôemoci√≥ compartida.</p>
                <p class="mb-4 font-semibold">Aqu√≠ tens algunes propostes per fer-ho possible a l‚Äôescola:</p>
                <div class="space-y-6">
                    <div class="bg-emerald-50 p-4 rounded-lg border border-emerald-100">
                        <p>üéµ <strong>Festival de can√ßons del nostre planeta</strong><br/><span class="text-sm text-emerald-700">Cicles inicial i mitj√†, √Ärea de Coneixement del Medi.</span><br/>Cada grup crea la lletra d‚Äôuna can√ß√≥ sobre un tema mediambiental treballat a classe: l‚Äôaigua, el reciclatge, els animals del bosc... Els alumnes escriuen la lletra col¬∑lectivament, la polen amb ChatGPT, i despr√©s generen la m√∫sica amb Suno triant estils diferents (pop, folk, √®pic...).</p>
                        <p class="mt-2 ml-4 border-l-2 border-emerald-300 pl-2">üé§ <strong>Cloenda</strong>: un petit festival musical verd on cada grup presenta la seva can√ß√≥ i explica com l‚Äôha creada.</p>
                    </div>
                    <div class="bg-indigo-50 p-4 rounded-lg border border-indigo-100">
                        <p>üßö‚Äç‚ôÄÔ∏è <strong>Can√ßons per a contes inventats</strong><br/><span class="text-sm text-indigo-700">Educaci√≥ Infantil i Cicle Inicial, √Ärea de Llengua i Expressi√≥ Musical.</span><br/>Despr√©s d‚Äôinventar un conte o una llegenda a classe, els infants creen amb ajuda de la mestra una can√ß√≥ tem√†tica per al seu relat: la can√ß√≥ del protagonista, del lloc m√†gic o del final feli√ß. Suno posa la m√∫sica, i la classe pot gravar-se cantant la tornada.</p>
                        <p class="mt-2 ml-4 border-l-2 border-indigo-300 pl-2">üé® <strong>Opcional</strong>: crear un √†lbum digital amb les portades dels contes i les seves bandes sonores.</p>
                    </div>
                    <div class="bg-amber-50 p-4 rounded-lg border border-amber-100">
                        <p>üåç <strong>Himne de la classe o de l‚Äôescola</strong><br/><span class="text-sm text-amber-700">Cicle Mitj√† i Superior ‚Äî Tutoria, Educaci√≥ en Valors, M√∫sica</span><br/>El grup escriu una lletra que representi els seus valors, emocions i maneres de conviure: amistat, esfor√ß, respecte, humor... Amb Suno, creen la m√∫sica de l‚Äô‚Äúhimne de la classe‚Äù, triant el g√®nere que m√©s els identifica.</p>
                        <p class="mt-2 ml-4 border-l-2 border-amber-300 pl-2">üéß <strong>Es pot escoltar en moments especials</strong> (inici de curs, celebracions, acomiadaments...).</p>
                    </div>
                    <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                        <p>üöÄ <strong>Can√ßons per aprendre continguts</strong><br/><span class="text-sm text-slate-600">Cicle Mitj√† i Superior, √Ärees diverses (Matem√†tiques, Angl√®s, Coneixement del Medi)</span><br/>Els alumnes creen petites lletres o tornades que resumeixin conceptes treballats: les taules de multiplicar, el cicle de l‚Äôaigua, o vocabulari en angl√®s. Despr√©s, generen amb Suno melodies que converteixin l‚Äôaprenentatge en m√∫sica.</p>
                        <p class="mt-2 ml-4 border-l-2 border-slate-300 pl-2">üéØ <strong>Objectiu</strong>: recordar millor i fer m√©s divertides les repeticions o estudis.</p>
                    </div>
                    <div class="bg-rose-50 p-4 rounded-lg border border-rose-100">
                        <p>üéß <strong>El claustre sona: experi√®ncies amb veu pr√≤pia</strong><br/><span class="text-sm text-rose-700">Professorat, Formaci√≥ interna i treball en equip</span><br/>Suno pot ser una porta d‚Äôentrada amable a la intel¬∑lig√®ncia artificial generativa. Crear m√∫sica desperta emoci√≥, complicitat i curiositat, i √©s una manera ideal de fer descobrir al professorat el potencial creatiu de la IAG sense requerir coneixements t√®cnics. Es pot proposar una din√†mica col¬∑laborativa: cada equip crea la lletra d‚Äôuna can√ß√≥ sobre un tema compartit ‚Äî la innovaci√≥, la conviv√®ncia o la identitat de l‚Äôescola.</p>
                        <p class="mt-2 ml-4 border-l-2 border-rose-300 pl-2">üé§ <strong>L‚Äôactivitat pot culminar amb una sessi√≥ d‚Äôescolta</strong> on cada grup presenta la seva creaci√≥ i comparteix qu√® ha descobert del proc√©s. El resultat no √©s nom√©s una can√ß√≥: √©s una experi√®ncia col¬∑lectiva que ajuda el professorat a entendre com la IAG pot ser una aliada creativa, emocional i educativa.</p>
                    </div>
                </div>`,
                choices: [{ text: "Continua al cap√≠tol 2 La pagesa de la Vall", target: "Captol_2" }]
            },
            "Captol_2": {
                title: "Cap√≠tol 2",
                image: "https://raultorres-ia.github.io/apps/gami_pericot/02.jpg",
                content: `<p>En un petit mas de la vall, hi vivia una pagesa de mirada curiosa i mans acostumades al treball de la terra. Cada mat√≠, mentre feinejava prop del monestir, observava des de la llunyania el bosc on s‚Äôamagava la font. Mentre les altres persones de la vall s'allunyaven del perill, ella es preguntava per qu√® s'havien de conformar amb la foscor si tenien el tresor tan a prop.</p>
                <p>La dona no era una guerrera, per√≤ tenia la paci√®ncia de qui sap esperar que el gra germini. Passava les hores sentint el murmuri de la gent i estudiant el comportament de la b√®stia. Sentia que a la seva comunitat li faltava aquella espurna de la gemma per millorar la vida dels seus ve√Øns, i el seu cor bategava amb una determinaci√≥ nova: trobaria la manera de portar la llum de la font al cor del poble.</p>`,
                choices: [{ text: "Cap√≠tol 3: La partida i el risc del monstre", target: "Captol_3" }]
            },
            "Captol_3": {
                title: "Cap√≠tol 3",
                image: "https://raultorres-ia.github.io/apps/gami_pericot/03.jpg",
                content: `<p>Una nit de lluna vella, la nostra protagonista va prendre la decisi√≥ de partir. Sabia que no seria una tasca f√†cil i que molts abans d'ella havien quedat paralitzats, devorats per una por que els impedia moure's (l'immobilisme que tot ho atura). Robar la gemma significava enfrontar-se a un fet desconegut, a un monstre que representava les nostres pr√≤pies resist√®ncies i el temor a all√≤ que no podem controlar.</p>
                <p>‚ÄîSi no ho provo ‚Äîva pensar mentre preparava el seu sarr√≥‚Äî, la serp continuar√† sent l'√∫nica propiet√†ria del nostre futur.</p>
                <p>El risc era real i la b√®stia, ferotge. Per√≤ el seu desig de transformaci√≥ era m√©s gran que la seva prud√®ncia. Amb un darrer cop d'ull a les parets del seu mas, es va endinsar en el bosc, conscient que el viatge la canviaria per sempre, o potser, l'acabaria consumint.</p>`,
                choices: [{ text: "Cap√≠tol 4: El miratge de les mil eines", target: "Captol_4" }]
            },
            "Captol_4": {
                title: "Cap√≠tol 4",
                image: "https://raultorres-ia.github.io/apps/gami_pericot/04.jpg",
                content: `<p>La dona no va anar directa a la font, sin√≥ que va rec√≥rrer tot Catalunya buscant el saber dels m√©s savis. Va visitar biblioteques oblidades, va preguntar a bruixots que deien con√®ixer el futur i va parlar amb alquimistes que prometien eines miraculoses. Li van oferir mil estris diferents: lents m√†giques, pols de colors i conjurs estranys que prometien fer-ho tot amb un sol gest.</p>
                <p>Al principi, tot li feia il¬∑lusi√≥. Es veia carregada de pergamins i artefactes estranys, conven√ßuda que com m√©s coses port√©s, m√©s segura estaria. Per√≤, al cap d'un temps, la sensaci√≥ de sobre informaci√≥ la va comen√ßar a ofegar. Tenia tantes receptes al cap i tants ginys al sarr√≥ que ja no sabia per on comen√ßar. Estava saturada, perduda en un bosc de possibilitats on no veia el cam√≠.</p>`,
                audio: "https://raultorres-ia.github.io/apps/gami_pericot/La_nova_compet√®ncia_digital_docent_en_IA.m4a",
                audioLabel: "Escolta la saviesa sobre all√≤ que ens preocupa",
                choices: [
                    { text: "Cap√≠tol 5: Retorn i saviesa", target: "Captol_5" },
                    { text: "- Descobreix com s'ha creat el p√≤dcast -", target: "NotebookLM" }
                ]
            },
            "NotebookLM": {
                title: "NotebookLM",
                image: "https://perecornella.cat/iaraque/imatges/notebooklm.jpg",
                content: `
                <p>La veu que acompanya la reflexi√≥ final de Lyra no √©s improvisada: √©s el fruit d‚Äôuna conversa entre documents, idees i intu√Øcions. Ha estat creada amb NotebookLM https://notebooklm.google.com/, una eina d‚Äôintel¬∑lig√®ncia artificial de Google dissenyada per generar coneixement a partir de textos propis, convertint-los en resums, esquemes o, com en aquest cas, un p√≤dcast conversacional. El proc√©s √©s senzill i potent alhora:</p>
                <ol class="list-decimal pl-5 space-y-3 mt-4 mb-4">
                    <li><strong>Crear un compte a NotebookLM</strong> amb el correu de Google.</li>
                    <li><strong>Afegir fonts de coneixement</strong>: textos, apunts, articles o fragments del relat de Lyra. En aquest cas nom√©s s‚Äôha afegit el document del Departament d‚ÄôEducaci√≥ sobre Intel¬∑lig√®ncia Artificial en l‚ÄôEducaci√≥: Orientacions i Recomanacions. √âs recomanable afegir m√©s fonts per enriquir els resultats.</li>
                    <li><strong>Generar un ‚Äúnotebook‚Äù</strong> i convidar-hi la IAG a fer de veu reflexiva.</li>
                    <li><strong>Activar la funci√≥ ‚ÄúResum d‚Äô√†udio‚Äù</strong>, que crea un p√≤dcast autom√†tic on dues veus sintetitzen i debaten les idees principals.</li>
                    <li><strong>Escoltar, ajustar i descarregar</strong> l‚Äô√†udio per compartir-lo de la forma que m√©s convingui. Aix√≠, la veu que escoltem no √©s nom√©s un resum: √©s una reinterpretaci√≥ viva del coneixement, un espai on la intel¬∑lig√®ncia artificial actua com a companya de conversa.</li>
                </ol>
                <p><strong>Per√≤ NotebookLM √©s molt m√©s que un p√≤dcast</strong></p>
                <p>Tot i que el p√≤dcast √©s la part m√©s visible del proc√©s, NotebookLM √©s molt m√©s que una veu que parla. √âs un espai on la intel¬∑lig√®ncia artificial ajuda a organitzar, comprendre i transformar informaci√≥. A partir dels textos que li aportem, pot:
                <ul class="list-disc pl-5 mt-2">
                    <li>resumir continguts complexos,</li>
                    <li>elaborar esquemes o s√≠ntesis tem√†tiques,</li>
                    <li>comparar documents,</li>
                    <li>extreure idees clau,</li>
                    <li>o fins i tot generar preguntes per estimular la reflexi√≥.</li>
                </ul>
                </p>
                <p>D‚Äôaquesta manera, NotebookLM es converteix en un company de pensament: una eina per aprendre a aprendre, capa√ß d‚Äôajudar tant a l‚Äôalumnat com al professorat a convertir la informaci√≥ en coneixement.</p>`,
                choices: [
                    { text: "- Veure algunes propostes d'√∫s -", target: "s_NotebookLM" },
                    { text: "Continua la cap√≠tol 5: Retorn i saviesa popular", target: "Captol_5" }
                ]
            },
            "s_NotebookLM": {
                title: "Propostes NotebookLM",
                image: "https://raultorres-ia.github.io/apps/gami_pericot/banner.jpg",
                content: `
                <p class="mb-4">Igual que la nostra pagesa escolta la veu del savi per entendre el cam√≠ recorregut, nosaltres tamb√© podem donar veu a l‚Äôaprenentatge. NotebookLM https://notebooklm.google.com ens permet transformar textos, reflexions o projectes en converses auditives: una manera nova de revisar, aprendre i compartir coneixement. Quan l‚Äôalumnat o el professorat escolta com la seva feina es converteix en un di√†leg entre veus, la comprensi√≥ es fa m√©s profunda i m√©s viva.</p>
                <div class="space-y-6">
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-100">
                        <p>üéôÔ∏è <strong>El nostre conte explicat per dues veus</strong><br/><span class="text-sm text-blue-700">Educaci√≥ Infantil i Cicle Inicial ‚Äî Llengua i Expressi√≥ Oral</span><br/>Els infants inventen un conte i la mestra l‚Äôescriu o l‚Äôenregistra. Despr√©s, es pot pujar el text a NotebookLM per generar un petit p√≤dcast on dues veus expliquen i comenten la hist√≤ria.</p>
                        <p class="mt-2 ml-4 border-l-2 border-blue-300 pl-2">üéß <strong>Es pot escoltar a classe</strong>, compartir amb les fam√≠lies o incloure en un rac√≥ d‚Äôaudiollibres.</p>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-lg border border-purple-100">
                        <p>üß© <strong>Debats escolars en format p√≤dcast</strong><br/><span class="text-sm text-purple-700">Cicle Mitj√†, √Ärees de Coneixement del Medi i Llengua Catalana.</span><br/>Cada grup investiga un tema (l‚Äôaigua, els animals en perill, els invents, etc.) i redacta un breu informe. Amb NotebookLM, converteixen aquell text en un p√≤dcast on dues veus discuteixen i sintetitzen la informaci√≥, ajudant-los a entendre millor el tema i a escoltar punts de vista diferents.</p>
                        <p class="mt-2 ml-4 border-l-2 border-purple-300 pl-2">üéØ <strong>Objectiu</strong>: millorar comprensi√≥ lectora i expressi√≥ oral a partir del que han escrit.</p>
                    </div>
                    <div class="bg-orange-50 p-4 rounded-lg border border-orange-100">
                        <p>ü™∂ <strong>Resum del projecte: la veu del que hem apr√®s</strong><br/><span class="text-sm text-orange-700">Cicle Superior ‚Äî Projectes interdisciplinaris</span><br/>Al final d‚Äôun projecte (per exemple, ‚ÄúEls ecosistemes‚Äù o ‚ÄúLa vida al passat‚Äù), l‚Äôalumnat puja els seus resums o presentacions a NotebookLM i genera un p√≤dcast de s√≠ntesi.</p>
                        <p class="mt-2 ml-4 border-l-2 border-orange-300 pl-2">üéß <strong>Es pot escoltar</strong> com a ‚Äúrevista sonora‚Äù del projecte o com a material de rep√†s col¬∑lectiu.</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                        <p>üó£Ô∏è <strong>El claustre</strong> pot utilitzar NotebookLM <strong>per donar veu a documents de treball o a materials de formaci√≥</strong>. A partir de textos (articles, protocols, plans d‚Äôinnovaci√≥...), la IA crea un p√≤dcast de resum i debat entre dues veus.</p>
                        <p class="mt-2 ml-4 border-l-2 border-gray-300 pl-2">üé§ <strong>Ideal per escoltar de cam√≠ a l‚Äôescola o com a punt de partida per a reunions pedag√≤giques</strong>. El resultat: un nou format per repensar, escoltar i compartir idees sense necessitat de llegir-ho tot.</p>
                    </div>
                </div>`,
                choices: [{ text: "Continua al cap√≠tol 5: Retorn i saviesa popular", target: "Captol_5" }]
            },
            "Captol_5": {
                title: "Cap√≠tol 5",
                image: "https://raultorres-ia.github.io/apps/gami_pericot/05.jpg",
                content: `
                <p>Amb les mans plenes d'objectes in√∫tils i el cap cansat, va tornar a la vall amb el cor abatut. Va ser llavors quan es va trobar amb un vell pag√®s que seia vora el cam√≠. En veure-la tan atrafegada amb tant d'instrument, l'home va somriure i li va ensenyar una vella bota de vi buida i un grapat de claus grossos. "No necessites m√†gia d'altres terres", li va dir, "necessites una estructura forta on protegir-te".</p>
                <p>Aquell home ja havia pensat en el perill i li va fer una proposta senzilla: fabricar una bota eri√ßada, una arma barata i efica√ß feta amb el que tenia a m√†. La noia va comprendre que la innovaci√≥ no era tenir-ho tot, sin√≥ tenir el que √©s √∫til i segur. Va escoltar amb atenci√≥ les regles del vell sobre com construir aquell refugi per no fer-se mal ni fer mal als altres.</p>`,
                choices: [{ text: "Cap√≠tol 6: La decisi√≥ √®tica i responsable", target: "Captol_6" }]
            },
            "Captol_6": {
                title: "Cap√≠tol 6",
                image: "https://raultorres-ia.github.io/apps/gami_pericot/06.jpg",
                content: `
                <p>Mentre clavava cada clau a la bota, de dins cap a fora, la dona reflexionava sobre les conseq√º√®ncies dels seus actes. No es tractava nom√©s d'abatre la serp; es tractava de com ho feia. Cada decisi√≥ que prenia tindria un impacte en el seu entorn, igual que les eines que havia descobert podien ser tant una cura com un ver√≠.</p>
                <p>Va decidir que el seu √∫s de la gemma seria responsable. No la volia per dominar, sin√≥ per il¬∑luminar. Aquell refugi eri√ßat era el seu l√≠mit √®tic: una barrera que la protegia del monstre, per√≤ que tamb√© li recordava que el poder s'ha de manejar amb cura. Amb la bota acabada i la consci√®ncia tranquil¬∑la, es va sentir preparada per al moment final.</p>
                <p>Per construir la trampa es necessita enginy, igual que per crear imatges.</p>`,
                choices: [
                    { text: "Cap√≠tol 7: L'emboscada i el setge a la serp", target: "Captol_7" },
                    { text: "- Com s'han creat les imatges -", target: "Nano_Banana" }
                ]
            },
            "Nano_Banana": {
                title: "Nano Banana - Gemini",
                image: "https://www.tirsomaldonado.es/wp-content/uploads/2025/09/nanobanana.jpg",
                content: `
                <p>Crear imatges amb Gemini √©s molt f√†cil. Nom√©s cal entrar a Gemini https://gemini.google.com/ amb un compte de Google i escriure una descripci√≥ del que volem veure a la imatge.</p>
                <p class="mt-4">Gemini genera la imatge a partir del text (indicaci√≥), aix√≠ que com m√©s clara i detallada sigui la descripci√≥, millor ser√† el resultat.</p>
                <p class="mt-4">Un cop creada la imatge, podem demanar petits canvis amb paraules senzilles, com modificar els colors, l‚Äôestil o algun element concret.</p>
                <p class="mt-4">Aquest proc√©s permet entendre que la imatge no la crea la m√†quina sola, sin√≥ que √©s el resultat de les decisions de qui escriu.</p>`,
                choices: [
                    { text: "- Veure algunes propostes d'√∫s -", target: "s_Nano_Banana" },
                    { text: "Continua al cap√≠tol 7: La trobada amb la serp", target: "Captol_7" }
                ]
            },
            "s_Nano_Banana": {
                title: "Propostes Imatges",
                content: `
                <p class="mb-4">√ös de la imatge com a recurs educatiu per afavorir l‚Äô<strong>aprenentatge i la inclusi√≥</strong>: permet</p>
                <ul class="list-disc pl-5 space-y-2">
                    <li>Crear il¬∑lustracions.</li>
                    <li>Materials visuals (contes, infografies)</li>
                    <li>Enriquir presentacions.</li>
                    <li>Editar i adaptar imatges</li>
                    <li>Estimular l‚Äôexpressi√≥ escrita</li>
                    <li>Elaborar c√≤mics i narratives educatives</li>
                    <li>Dissenyar avatars o personatges per a projectes de gamificaci√≥ i breakouts, atenent la diversitat de l‚Äôalumnat (DUA).</li>
                </ul>`,
                choices: [{ text: "Continua al cap√≠tol 7: La trobada amb la serp", target: "Captol_7" }]
            },
            "Captol_7": {
                title: "Cap√≠tol 7",
                image: "https://raultorres-ia.github.io/apps/gami_pericot/07.jpg",
                content: `
                <p>A tocar de la deu, abans que sort√≠s el sol, la nostra protagonista es va tancar dins la bota eri√ßada. Pel forat de la tapa, va veure com la serp s'apropava i deixava la pedra preciosa a terra per beure l'oli de la font. Amb el cor bategant, va allargar la m√† amb precisi√≥, va agafar la gemma i es va tancar de nou en la penombra del seu refugi de fusta.</p>
                <p>L'infern es va deslligar. La serp, en descobrir el robatori, va xiular tan fort que les muntanyes van trontollar i es va enroscar amb tota la seva f√∫ria al voltant de la bota per aixafar-la. Per√≤ com m√©s for√ßa feia el monstre, m√©s se li clavaven els claus a la pell. La noia, aterrada, per√≤ protegida, aguantava la pressi√≥ mentre la serp moria v√≠ctima de la seva pr√≤pia r√†bia contra aquell enginy senzill.</p>`,
                choices: [{ text: "Cap√≠tol 8: Triomf i lli√ßons apreses", target: "Captol_8" }]
            },
            "Captol_8": {
                title: "Cap√≠tol 8",
                image: "https://raultorres-ia.github.io/apps/gami_pericot/08.jpg",
                content: `
                <p>La bota va rodolar fins a la llera del riu Galligants, on finalment es va aturar el silenci. La nostra pagesa en va sortir, bruta i cansada, per√≤ amb la gemma brillant a la seva m√†. Havia aconseguit el que buscava, per√≤ el viatge li havia ensenyat que el veritable poder no era la pedra en si, sin√≥ la capacitat de no deixar-se v√®ncer per la por.</p>
                <p>Quan va tornar al poble, la recepci√≥ va ser un clam d'alegria. Per√≤ ella no va mostrar la gemma com un trofeu de guerra, sin√≥ com una eina de futur. Va explicar com n'havia estat de dif√≠cil triar el cam√≠ correcte i com, amb poques eines, per√≤ ben triades i un refugi segur, havia aconseguit v√®ncer un monstre que semblava invencible.</p>`,
                choices: [{ text: "Cap√≠tol 9: El Toolkit de la Vall", target: "Captol_9" }]
            },
            "Captol_9": {
                title: "Cap√≠tol 9",
                image: "https://raultorres-ia.github.io/apps/gami_pericot/09.jpg",
                content: `
                <p>Perqu√® la seva experi√®ncia no es perd√©s en el temps, la nostra protagonista va decidir endre√ßar tot el que havia apr√®s. Va agafar el seu millor pergam√≠ i va escriure una llista de les eines que realment funcionaven, els perills que calia evitar i els consells del vell pag√®s. Volia que qualsevol habitant de la Vall de Sant Daniel pogu√©s usar la gemma sense por.</p>
                <p>Aquest "receptari" es va convertir en el tresor m√©s preuat de la comunitat. Ja no necessitaven viatjar lluny ni comprar m√†gies cares; tenien el seu propi cam√≠ tra√ßat. Aix√≠, la llegenda de la Font d‚Äôen Pericot va deixar de ser una hist√≤ria de por per ser una hist√≤ria d'enginy, on el bon √∫s de la saviesa (la nostra IA) ajudava a tothom a viure una mica millor.</p>
                <p class="mt-4 font-semibold">I per ajudar la comunitat a fer el trasp√†s de la saviesa va crear un q√ºestionari https://drive.google.com/file/d/1H6kPJcVKhxx9VARi7q2L0jKC2zMKOT-C/view</p>`,
                choices: [
                    { text: "- Saps com s'ha creat el q√ºestionari -", target: "Brisk" },
                    { text: "Accedeix al receptari de la comunitat", target: "Eines" }
                ]
            },
            "Brisk": {
                title: "Brisk",
                image: "https://www.commonsense.org/sites/default/files/png/2024-04/brisk-teaching-website-logo.png",
                content: `
                <p class="mb-4"><b>Brisk </b>(https://www.briskteaching.com/es) √©s una eina d‚Äôintel¬∑lig√®ncia artificial dissenyada per donar suport al professorat d‚Äôeducaci√≥ infantil i prim√†ria, amb l‚Äôobjectiu principal de reduir la c√†rrega de treball administrativa i pedag√≤gica, i permetre al docent dedicar m√©s temps a l‚Äôacompanyament directe de l‚Äôalumnat. No substitueix la tasca del mestre o mestra, sin√≥ que actua com un assist√®ncia pedag√≤gica digital que ajuda a preparar materials i a prendre decisions did√†ctiques amb m√©s agilitat.</p>
                <p class="mb-4">En l‚Äô√†mbit de la <strong>planificaci√≥</strong>, Brisk facilita la creaci√≥ i adaptaci√≥ de materials educatius ajustats al nivell de l‚Äôaula. Permet reformular textos en llenguatge senzill, generar activitats de comprensi√≥ lectora, propostes d‚Äôexpressi√≥ escrita o exercicis graduats segons el nivell de compet√®ncia dels infants, fet que afavoreix una atenci√≥ m√©s acurada a la diversitat dins l‚Äôaula.</p>
                <p class="mb-4">Pel que fa a l‚Äô<strong>avaluaci√≥ formativa</strong>, Brisk pot ajudar a elaborar comentaris de retorn clars i constructius sobre les produccions de l‚Äôalumnat. Ofereix suggeriments de feedback que posen el focus en el proc√©s d‚Äôaprenentatge, en els aspectes a millorar i en els punts forts, fomentant aix√≠ una avaluaci√≥ m√©s orientadora i coherent amb un enfocament competencial.</p>
                <p class="mb-4">A educaci√≥ infantil, l‚Äôeina resulta especialment √∫til per pensar <strong>contes, situacions d‚Äôaprenentatge, jocs i activitats l√∫diques </strong>que estimulin el llenguatge, la creativitat i el pensament, sempre adaptades a l‚Äôedat dels infants. A prim√†ria, permet simplificar continguts, generar exemples contextualitzats i crear propostes interdisciplin√†ries que connectin amb la realitat de l‚Äôalumnat.</p>
                <p class="mb-6">En conjunt, Brisk es presenta com un recurs de<strong> suport al professional docent</strong>, que ajuda a optimitzar temps, a personalitzar l‚Äôaprenentatge i a millorar la qualitat del feedback, sempre des d‚Äôun √∫s conscient i cr√≠tic de la intel¬∑lig√®ncia artificial, amb la mirada pedag√≤gica i el criteri del mestre com a elements centrals del proc√©s educatiu.</p>
                <div class="bg-blue-50 p-4 rounded-lg text-center space-y-2">
                    <p>Tot seguit us facilitem un minitutorial per fer el q√ºestionari https://drive.google.com/file/d/1h9GKo5Wi22Z6xV85d1Gw4eqyVHlX3wX5/view.</p>
                    <p>Si vols saber m√©s coses de Brisk teniu un<strong> videotutorial de Rosa Liarte</strong> https://www.youtube.com/watch?v=uJCzNrh3Uc8</p>
                </div>`,
                choices: [{ text: "Torna al cap√≠tol 9: El Toolkit de la Vall", target: "Captol_9" }]
            },
            "Eines": {
                title: "Eines del Viatge",
                content: `
                <p class="mb-4">Despr√©s del viatge, arriba el moment de mirar enrere i entendre qu√® ha passat de deb√≤.</p>
                <p class="mb-4">A la vall, tothom explicava la mateixa hist√≤ria: una pagesa havia estat capa√ß de v√®ncer la serp, aquella criatura enorme que simbolitzava la por a la intel¬∑lig√®ncia artificial. No la va derrotar amb for√ßa bruta, sin√≥ amb coneixement, criteri i consci√®ncia.</p>
                <p class="mb-4">Cada ‚Äúfor√ßa‚Äù que va acompanyar la pagesa representa una manera d‚Äôentendre la IA generativa a l‚Äôaula: crear, escoltar, imaginar, dialogar i repensar.</p>
                <p class="mb-4">Ara tu tamb√© pots reviure aquestes forces, explorar-les i portar-les al teu context educatiu.</p>
                <p class="mb-6 p-3 bg-yellow-50 border-l-4 border-yellow-400 text-yellow-800">‚ö†Ô∏è Si encara no has fet aquest viatge, et recomano comen√ßar pel principi. Les forces nom√©s revelen el seu sentit complet despr√©s d‚Äôhaver travessat la por.</p>
                <div class="space-y-6">
                    <div>
                        <p class="font-bold text-lg text-emerald-700">üéµ La for√ßa de la veu ‚Äî Suno https://suno.com/</p>
                        <p class="ml-6">Amb Suno, pots crear can√ßons a partir de lletres pr√≤pies, poemes de classe o reflexions de l‚Äôalumnat, i entendre com la IA pot donar veu a la creativitat, no substituir-la.</p>
                    </div>
                    <div>
                        <p class="font-bold text-lg text-emerald-700">üéôÔ∏è La for√ßa de la narraci√≥ ‚Äî NotebookLM https://notebooklm.google.com/</p>
                        <p class="ml-6">Amb NotebookLM, pots transformar textos, idees o documents en p√≤dcasts generats per IA, i treballar la compet√®ncia comunicativa, la s√≠ntesi i la mirada cr√≠tica.</p>
                    </div>
                    <div>
                        <p class="font-bold text-lg text-emerald-700">üçå La for√ßa de la imaginaci√≥ ‚Äî Nano Banana - Gemini https://gemini.google.com/</p>
                        <p class="ml-6">Amb Nano Banana (Gemini), l‚Äôalumnat pot crear imatges (amb consentiment de les fam√≠lies) a partir d‚Äôidees, hist√≤ries o conceptes curriculars, i reflexionar sobre com la IA representa el m√≥n i com podem q√ºestionar aquestes representacions.</p>
                    </div>
                    <div>
                        <p class="font-bold text-lg text-emerald-700">üí¨ La for√ßa del di√†leg ‚Äî Brisk Teaching https://www.briskteaching.com/es</p>
                        <p class="ml-6">Amb Brisk, pots acompanyar el proc√©s d‚Äôaprenentatge: generar feedback, adaptar activitats i provocar preguntes que facin pensar. La IA esdev√© una eina de suport, no una resposta autom√†tica</p>
                    </div>
                    <div>
                        <p class="font-bold text-lg text-emerald-700">üåÄ La for√ßa del proc√©s ‚Äî d‚ÄôInklewriter a Vibe Coding https://www.inklewriter.com/stories/267083</p>
                        <p class="ml-6">Darrere de cada hist√≤ria, projecte o recurs digital, sempre hi ha un proc√©s de creaci√≥ que sovint queda invisible. El treball comen√ßa a Inklewriter, una eina senzilla per donar forma a narratives interactives, i evoluciona cap al Vibe Coding amb Gemini i Google AI Studio, on el llenguatge natural, el codi i l‚Äôestructura digital dialoguen constantment.</p>
                    </div>
                    <div>
                        <p class="font-bold text-lg text-emerald-700">üß≠ La for√ßa del repensar ‚Äî el cam√≠ conscient</p>
                        <p class="ml-6 mb-2">Quan la serp va caure, la pagesa va entendre que la vict√≤ria no era el final, sin√≥ l‚Äôinici d‚Äôuna responsabilitat. Tot all√≤ apr√®s cal repensar-ho: qu√® fem amb la IA, per qu√® la fem servir i amb quin impacte educatiu.</p>
                        <p class="ml-6 mb-2">Aquesta for√ßa no √©s una eina concreta, sin√≥ una actitud pedag√≤gica:</p>
                        <ul class="list-disc pl-12 space-y-1 text-gray-700">
                            <li>√ös conscient.</li>
                            <li>Mirada cr√≠tica.</li>
                            <li>Aprenentatge amb sentit.</li>
                        </ul>
                        <p class="ml-6 mt-2">Perqu√® la tecnologia no √©s nom√©s un mitj√†, sin√≥ un espai d‚Äôaprenentatge.</p>
                    </div>
                </div>
                <p class="mt-8 italic text-center text-gray-600">Cada vegada que perdem la por, que reescrivim una activitat, que ajustem una proposta o que ens fem bones preguntes, tamb√© estem fent el nostre propi viatge. I com la pagesa, descobrim que la serp no es ven√ß evitant-la, sin√≥ entenent-la.</p>`,
                choices: [{ text: "Tornar a l'inici", target: "Introducci" }]
            }
        };

        const TextRenderer = ({ content, isBookMode }) => {
            const processText = (text) => {
                const urlRegex = /((?:https?:\/\/)[^\s<)]+)/g;
                return text.replace(urlRegex, (url) => {
                    const cleanUrl = url.replace(/[)]$/, '');
                    return `<a href="${cleanUrl}" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:text-blue-800 hover:underline inline-flex items-center gap-1 break-all">${cleanUrl} <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a>`;
                });
            };

            return (
                <div 
                    className={`${isBookMode ? 'text-stone-900 leading-relaxed text-lg font-serif' : 'text-gray-800 leading-relaxed text-lg'}`}
                    dangerouslySetInnerHTML={{ __html: processText(content) }} 
                />
            );
        };

        function App() {
            const [currentNodeId, setCurrentNodeId] = useState('Introducci');
            const [history, setHistory] = useState(['Introducci']);
            const [animationKey, setAnimationKey] = useState(0); // Clau per for√ßar la renderitzaci√≥ i animaci√≥
            const topRef = useRef(null);

            const currentNode = storyData[currentNodeId];
            const currentStep = nodeSteps[currentNodeId] || 1;
            const progressPercent = (currentStep / totalSteps) * 100;
            const introNodes = ['Introducci', 'dinsDaquestViatg', 'perTalDeVncerLaS'];
            const isBookMode = !introNodes.includes(currentNodeId);

            useEffect(() => {
                if (topRef.current) {
                    topRef.current.scrollIntoView({ behavior: 'smooth' });
                }
            }, [currentNodeId]);

            const handleChoice = (targetId) => {
                if (targetId === 'END') return;
                setHistory([...history, targetId]);
                setCurrentNodeId(targetId);
                setAnimationKey(prev => prev + 1); // Dispara l'animaci√≥
            };

            const handleBack = () => {
                if (history.length > 1) {
                    const newHistory = history.slice(0, -1);
                    setHistory(newHistory);
                    setCurrentNodeId(newHistory[newHistory.length - 1]);
                    setAnimationKey(prev => prev + 1);
                }
            };

            const handleReset = () => {
                if (window.confirm("Vols reiniciar l'aventura?")) {
                    setCurrentNodeId('Introducci');
                    setHistory(['Introducci']);
                    setAnimationKey(prev => prev + 1);
                }
            };

            const goHome = () => {
                setCurrentNodeId('Introducci');
                setHistory(['Introducci']);
                setAnimationKey(prev => prev + 1);
            };

            if (!currentNode) return <div className="p-10 text-center">Error: Node no trobat</div>;

            return (
                <div className={`min-h-screen font-sans selection:bg-amber-100 transition-colors duration-500 ${isBookMode ? 'bg-[#2c2a25]' : 'bg-stone-100'}`}>
                    <div ref={topRef} />
                    
                    {/* Header */}
                    <header className="bg-emerald-800 text-white shadow-lg sticky top-0 z-50">
                        <div className="max-w-3xl mx-auto px-4 py-3 flex justify-between items-center">
                            <div className="flex items-center gap-2 w-full max-w-lg">
                                <IconBookOpen className="h-6 w-6 flex-shrink-0" />
                                <div className="flex flex-col w-full mr-4">
                                    <h1 className="text-lg font-bold truncate leading-tight">El Tresor de la Font d‚Äôen Pericot</h1>
                                    <div className="w-full bg-emerald-900/50 rounded-full h-1.5 mt-1.5 overflow-hidden">
                                        <div 
                                            className="bg-emerald-300 h-1.5 rounded-full transition-all duration-500 ease-out" 
                                            style={{ width: `${progressPercent}%` }}
                                        ></div>
                                    </div>
                                </div>
                            </div>
                            <div className="flex gap-2 flex-shrink-0">
                                {history.length > 1 && (
                                    <button onClick={handleBack} className="p-2 hover:bg-emerald-700 rounded-full transition-colors" title="Enrere">
                                        <IconArrowLeft className="h-5 w-5" />
                                    </button>
                                )}
                                <button onClick={goHome} className="p-2 hover:bg-emerald-700 rounded-full transition-colors" title="Tornar a l'inici">
                                    <IconHome className="h-5 w-5" />
                                </button>
                                <button onClick={handleReset} className="p-2 hover:bg-emerald-700 rounded-full transition-colors" title="Reiniciar aventura">
                                    <IconRotateCcw className="h-5 w-5" />
                                </button>
                            </div>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="max-w-3xl mx-auto px-4 py-8 pb-20 perspective-container">
                        {/* El 'key' for√ßa a React a recrear el component, disparant l'animaci√≥ CSS */}
                        <div key={animationKey} className={`
                            page-enter overflow-hidden transition-all duration-500 ease-in-out relative
                            ${isBookMode 
                                ? 'rounded-r-md rounded-l-sm ml-4 shadow-2xl' 
                                : 'bg-white rounded-xl shadow-xl border border-stone-200'
                            }
                        `}>
                            
                            {/* Llibre "Spine" i Fons del llibre */}
                            {isBookMode && (
                                <React.Fragment>
                                    <div className="absolute top-0 bottom-0 left-0 w-12 z-20 bg-gradient-to-r from-emerald-950 via-emerald-800 to-emerald-900 shadow-[2px_0_5px_rgba(0,0,0,0.5)] border-r border-emerald-950"></div>
                                    <div className="absolute top-0 bottom-0 left-0 w-4 z-30 bg-gradient-to-r from-white/10 to-transparent pointer-events-none"></div>
                                </React.Fragment>
                            )}

                            {/* Contingut interior (P√†gina) */}
                            <div className={`${isBookMode ? 'bg-[#fff8e1] pl-16 pr-8 py-8 min-h-[600px] shadow-[inset_10px_0_20px_rgba(0,0,0,0.1)]' : ''}`}>

                                {/* Imatge de cap√ßalera del node */}
                                {currentNode.image && (
                                    <div className={`w-full relative bg-gray-200 ${isBookMode ? 'mb-8 shadow-md border-4 border-white transform -rotate-1' : ''}`}>
                                        <img 
                                            src={currentNode.image} 
                                            alt={currentNode.title} 
                                            className={`w-full h-auto ${isBookMode ? 'sepia-[.20] contrast-[0.9]' : ''}`}
                                            onError={(e) => { e.target.style.display = 'none'; }}
                                        />
                                        {!isBookMode && (
                                            <div className="absolute bottom-4 left-4 text-white">
                                                <h2 className="text-2xl font-bold shadow-black drop-shadow-md">{currentNode.title}</h2>
                                            </div>
                                        )}
                                        {!isBookMode && <div className="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent pointer-events-none"></div>}
                                    </div>
                                )}

                                {!currentNode.image && (
                                    <div className={`${isBookMode ? 'border-b-2 border-emerald-900/30 mb-8 pb-2' : 'bg-emerald-50 border-b border-emerald-100 px-6 py-4'}`}>
                                        <h2 className={`text-2xl font-bold ${isBookMode ? 'text-emerald-900 font-serif text-3xl italic' : 'text-emerald-900'}`}>{currentNode.title}</h2>
                                    </div>
                                )}
                                
                                {isBookMode && currentNode.image && (
                                    <div className="mb-6 text-center">
                                        <h2 className="text-3xl font-serif font-bold text-emerald-950 border-b-2 border-emerald-900/20 inline-block pb-2 px-4">{currentNode.title}</h2>
                                    </div>
                                )}

                                <div className={`${!isBookMode ? 'p-6 md:p-8 space-y-6' : 'space-y-6'}`}>
                                    
                                    <div className={`prose max-w-none ${isBookMode ? 'prose-stone prose-lg prose-p:font-serif prose-headings:font-serif text-stone-900' : 'prose-stone'}`}>
                                        <TextRenderer content={currentNode.content} isBookMode={isBookMode} />
                                    </div>

                                    {currentNode.audio && (
                                        <div className={`${isBookMode ? 'bg-[#f3ead2] border-emerald-900/20' : 'bg-amber-50 border-amber-200'} rounded-lg p-4 border flex flex-col gap-2 mt-6`}>
                                            <div className={`flex items-center gap-2 ${isBookMode ? 'text-emerald-900' : 'text-amber-800'} font-medium`}>
                                                <IconVolume2 className="h-5 w-5" />
                                                <span>{currentNode.audioLabel || "√Äudio del cap√≠tol"}</span>
                                            </div>
                                            <audio controls className="w-full mt-2 mix-blend-multiply" src={currentNode.audio}></audio>
                                        </div>
                                    )}

                                    {currentNode.links && (
                                        <div className="flex flex-col gap-2 mt-6">
                                            {currentNode.links.map((link, idx) => (
                                                <a key={idx} href={link.url} target="_blank" rel="noopener noreferrer" className={`flex items-center gap-3 p-3 rounded-lg transition-colors border group ${isBookMode ? 'bg-[#fdfbf7] border-stone-300 text-emerald-900 hover:bg-white shadow-sm' : 'bg-indigo-50 text-indigo-700 hover:bg-indigo-100 border-indigo-100'}`}>
                                                    <IconMusic className="h-5 w-5 flex-shrink-0" />
                                                    <span className="font-medium">{link.text}</span>
                                                    <IconExternalLink className="h-4 w-4 ml-auto opacity-50 group-hover:opacity-100" />
                                                </a>
                                            ))}
                                        </div>
                                    )}

                                    <hr className={`${isBookMode ? 'border-emerald-900/20' : 'border-stone-200'} my-8`} />

                                    <div className="space-y-3 pb-8">
                                        <h3 className={`text-sm uppercase tracking-wider text-stone-500 font-semibold mb-3 ${isBookMode ? 'font-serif text-center text-emerald-900/60' : ''}`}>
                                            {isBookMode ? '‚ùß Qu√® vols fer? ‚ùß' : 'Qu√® vols fer?'}
                                        </h3>
                                        {currentNode.choices && currentNode.choices.map((choice, index) => (
                                            <button key={index} onClick={() => handleChoice(choice.target)} className={`
                                                w-full text-left p-4 transition-all duration-200 flex items-center justify-between group shadow-sm hover:shadow-md
                                                ${isBookMode 
                                                    ? 'bg-white border border-stone-300 hover:border-emerald-700 rounded-sm font-serif text-stone-900 text-lg' 
                                                    : 'rounded-lg border-2 border-emerald-100 hover:border-emerald-500 hover:bg-emerald-50 bg-white font-medium text-emerald-900'
                                                }
                                            `}>
                                                <span className={`${isBookMode ? 'group-hover:text-emerald-900' : 'group-hover:text-emerald-700'}`}>{choice.text}</span>
                                                <IconArrowRight className={`h-5 w-5 transform group-hover:translate-x-1 transition-transform ${isBookMode ? 'text-emerald-800' : 'text-emerald-400 group-hover:text-emerald-600'}`} />
                                            </button>
                                        ))}
                                        {(!currentNode.choices || currentNode.choices.length === 0) && (
                                            <div className="text-center p-4 text-stone-500 italic">
                                                Fi de l'aventura per ara.
                                                <button onClick={handleReset} className="block mx-auto mt-4 text-emerald-600 font-bold hover:underline">Tornar a comen√ßar</button>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </main>

                    <footer className={`${isBookMode ? 'bg-[#1a1916] text-stone-400' : 'bg-stone-200 text-stone-500'} py-8 px-4 text-center text-xs transition-colors duration-500 space-y-4`}>
                        <div>
                            <p className="font-bold text-sm">El tresor de la Font d'en Pericot</p>
                            <p>¬© 2026 Ra√ºl i Genia</p>
                        </div>
                        <div className="max-w-2xl mx-auto space-y-2 opacity-80">
                            <p>El codi d'aquesta aplicaci√≥ est√† disponible sota la llic√®ncia AGPL v3. Consulteu el text complet a <a href="https://www.gnu.org/licenses/agpl-3.0.html" target="_blank" rel="noopener noreferrer" className="underline hover:text-emerald-500">https://www.gnu.org/licenses/agpl-3.0.html</a>.</p>
                            <p>Els continguts educatius (textos, exercicis, v√≠deos i imatges) tenen la llic√®ncia CC BY-SA 4.0. Consulteu el text complet a <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer" className="underline hover:text-emerald-500">https://creativecommons.org/licenses/by-sa/4.0/</a>.</p>
                        </div>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
